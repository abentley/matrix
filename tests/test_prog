#!/usr/bin/env matrix
tests:
- name: deployment
  description: Deploy with Glitches
  rules:
    - do:
        action: matrix.plugins.deploy.deploy
        entity: cs:bundle/wiki-simple
        version: current
    - do:
        action: tests.chaos.chaos
    - do:
        action: health
      until: chaos.complete
      "on": state.change
      after: deploy
- name: traffic
  description: Traffic in the face of Chaos
  rules:
    - do:
        action: matrix.plugins.deploy.deploy
        entity: cs:bundle/wiki-simple
        version: current
    - do:
        action: tests.traffic.test_traffic
      until: chaos.complete
      after: deploy
    - do:
        action: tests.chaos.chaos
      while: test_traffic
    - do:
        action: health
      periodic: 5
      until: chaos.complete
      after: deploy
